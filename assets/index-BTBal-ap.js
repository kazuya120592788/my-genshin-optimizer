import{x as $,a as j,r as l,b5 as G,b6 as se,b7 as le,d as e,e as s,G as h,T as A,af as x,ac as b,am as ce,f as B,av as L,M as H,b8 as P,b9 as ie,ba as re,bb as pe,bc as de,aq as V,ar as Q,Q as N,bd as ue,be as he,bf as me,B as ge,bg as ye,N as J,h as X,ao as z,ap as fe,F as U,E as we,bh as ke,a5 as We,ae as be,ab as xe,aC as Te,bi as Se,as as Ce,aG as Ie,aH as ve,aI as qe,bj as De,bk as Ee,bl as Ke,aK as Be,aL as Me,bm as Fe,S as O,bn as Le,bo as Ne,bp as Y}from"./index-BaYcb-Td.js";const Z=["locked","unlocked"],ze=ue([...Z]);function Ae({numShowing:u,total:n,weaponIds:c}){const{t:p}=$(["page_weapon","ui"]),o=j(),[w,q]=l.useState(o.displayWeapon.get());l.useEffect(()=>{o.displayWeapon.follow((a,r)=>q(r))},[o]);const{weaponType:D,rarity:T,locked:d,showEquipped:i,showInventory:S,locations:C}=w,y=l.useMemo(()=>G(we,a=>o.weapons.entries.forEach(([r,k])=>{const m=U(k.key).weaponType;a[m].total++,c.includes(r)&&a[m].current++})),[o,c]),f=l.useMemo(()=>G(ke,a=>o.weapons.entries.forEach(([r,k])=>{const m=U(k.key).rarity;a[m].total++,c.includes(r)&&a[m].current++})),[o,c]),{lockedTotal:E,equippedTotal:I,locationTotal:K}=l.useMemo(()=>{const a={lockedTotal:["locked","unlocked"],equippedTotal:["equipped","unequipped"],locationTotal:[...se,""]};return le(a,r=>o.weapons.entries.forEach(([k,m])=>{const W=m.location,g=m.lock?"locked":"unlocked",v=W?"equipped":"unequipped";r.lockedTotal[g].total++,r.equippedTotal[v].total++,r.locationTotal[W].total++,c.includes(k)&&(r.lockedTotal[g].current++,r.equippedTotal[v].current++,r.locationTotal[W].current++)}))},[o,c]);return e(X,{children:s(J,{sx:{display:"flex",flexDirection:"column",gap:1},children:[s(h,{container:!0,children:[e(h,{item:!0,children:e(A,{variant:"h6",children:p("weaponFilterTitle")})}),e(h,{item:!0,flexGrow:1,display:"flex",justifyContent:"center",alignItems:"center",children:s(A,{children:[e("strong",{children:u})," / ",n]})}),e(h,{item:!0,children:e(x,{size:"small",color:"error",onClick:()=>o.displayWeapon.set({action:"reset"}),startIcon:e(ce,{}),children:e(b,{t:p,i18nKey:"ui:reset"})})})]}),e(B,{children:s(h,{container:!0,spacing:1,children:[s(h,{item:!0,xs:12,md:6,display:"flex",flexDirection:"column",children:[e(b,{t:p,i18nKey:"subheadings.general"}),s(L,{spacing:1,children:[e(H,{sx:{bgcolor:P.palette.contentNormal.light}}),e(ie,{fullWidth:!0,onChange:a=>o.displayWeapon.set({weaponType:a}),value:D,totals:y,size:"small"}),e(re,{sx:{height:"100%"},fullWidth:!0,onChange:a=>o.displayWeapon.set({rarity:a}),value:T,totals:f,size:"small"})]})]}),e(h,{item:!0,xs:12,md:6,display:"flex",flexDirection:"column",gap:1,children:s(B,{children:[e(b,{t:p,i18nKey:"subheadings.inventory"}),s(L,{spacing:1,children:[e(H,{sx:{bgcolor:P.palette.contentNormal.light}}),e(pe,{fullWidth:!0,value:d,size:"small",children:Z.map((a,r)=>s(de,{value:a,sx:{display:"flex",gap:1},onClick:()=>o.displayWeapon.set({locked:ze(d,a)}),children:[r?e(V,{}):e(Q,{}),e(b,{t:p,i18nKey:`ui:${a}`}),e(N,{label:E[r?"unlocked":"locked"],size:"small"})]},a))}),s(x,{startIcon:e(he,{}),color:S?"success":"secondary",onClick:()=>o.displayWeapon.set({showInventory:!S}),children:[p("weaponInInv")," ",e(N,{sx:{ml:1},label:I.unequipped,size:"small"})]}),s(x,{startIcon:e(me,{}),color:i?"success":"secondary",onClick:()=>o.displayWeapon.set({showEquipped:!i}),children:[p("equippedWeapon")," ",e(N,{sx:{ml:1},label:I.equipped,size:"small"})]})]}),e(L,{spacing:1.5,pt:1.5,children:e(l.Suspense,{fallback:null,children:e(ge,{title:i?p("locationsTooltip"):"",placement:"top",children:e("span",{children:e(ye,{totals:K,locations:i?[]:C,setLocations:a=>o.displayWeapon.set({locations:a}),disabled:i})})})})})]})})]})})]})})}function $e({weaponIds:u}){const{t:n}=$(["page_weapon","ui"]),c=j(),{numDelete:p,numUnlock:o,numLock:w}=l.useMemo(()=>{const d=u.map(y=>c.weapons.get(y)),i=d.reduce((y,f)=>y+(f.lock?0:1),0),S=d.length-i;return{numDelete:d.reduce((y,f)=>y+(f.lock||f.location?0:1),0),numUnlock:i,numLock:S}},[u,c]);return s(h,{container:!0,spacing:1,alignItems:"center",children:[e(h,{item:!0,xs:16,sm:8,md:4,children:s(x,{fullWidth:!0,color:"error",disabled:!p,onClick:()=>window.confirm(`Are you sure you want to delete ${p} weapons?`)&&u.map(d=>{const i=c.weapons.get(d);!(i!=null&&i.lock)&&!(i!=null&&i.location)&&c.weapons.remove(d)}),startIcon:e(fe,{}),children:[e(b,{t:n,i18nKey:"button.deleteWeapons",children:"Delete Weapons"}),e(z,{sx:{ml:1},color:p?"success":"secondary",children:p})]})}),e(h,{item:!0,xs:16,sm:8,md:4,children:s(x,{fullWidth:!0,color:"error",disabled:!w,onClick:()=>window.confirm(`Are you sure you want to unlock ${w} weapons ?`)&&u.map(d=>c.weapons.set(d,{lock:!1})),startIcon:e(V,{}),children:[e(b,{t:n,i18nKey:"button.unlockWeapons",children:"Unlock Weapons"}),e(z,{sx:{ml:1},color:w?"success":"secondary",children:w})]})}),e(h,{item:!0,xs:16,sm:8,md:4,children:s(x,{fullWidth:!0,color:"error",disabled:!o,onClick:()=>window.confirm(`Are you sure you want to lock ${o} weapons ?`)&&u.map(d=>c.weapons.set(d,{lock:!0})),startIcon:e(Q,{}),children:[e(b,{t:n,i18nKey:"button.lockWeapons",children:"Lock Weapons"}),e(z,{sx:{ml:1},color:o?"success":"secondary",children:o})]})}),e(h,{item:!0,xs:12,display:"flex",justifyContent:"space-around",children:e(A,{variant:"caption",color:"text.secondary",children:s(b,{t:n,i18nKey:"buttonHint",children:["Note: the red buttons above only apply to",e("b",{children:"currently filtered weapons"})]})})})]})}const je={xs:1,sm:2,md:3,lg:3,xl:4},Re={xs:10,sm:12,md:24,lg:24,xl:24},_e=Object.keys(Y);function He(){const{t:u}=$(["page_weapon","ui","weaponNames_gen"]),n=j(),c=We(n.displayWeapon),[p,o,w]=be(!1);l.useEffect(()=>{xe.send({hitType:"pageview",page:"/weapon"})},[]);const q=Te(),D=l.useCallback(async t=>{const _=n.weapons.get(t);if(!_)return;const te=u(`weaponNames_gen:${_.key}`);window.confirm(u("removeWeapon",{value:te}))&&(n.weapons.remove(t),c.editWeaponId===t&&n.displayWeapon.set({editWeaponId:""}))},[c.editWeaponId,n,u]),T=l.useCallback(t=>{n.displayWeapon.set({editWeaponId:t})},[n]),d=l.useCallback(t=>{T(n.weapons.new(Se(t)))},[n,T]),[i,S]=l.useState(""),C=l.useDeferredValue(i),{sortType:y,ascending:f,weaponType:E,rarity:I,locked:K,showEquipped:a,showInventory:r,locations:k}=c,m=Ce(n.weapons),W=m.length,g=l.useMemo(()=>m.filter(Ie({weaponType:E,rarity:I,name:C,locked:K,showInventory:r,showEquipped:a,locations:k},Le())).sort(ve(Y[y]??[],f,Ne())).map(t=>t.id),[m,E,I,C,K,r,a,k,y,f]),{numShow:v,setTriggerElement:ee}=qe(Re[q],g.length),M=l.useMemo(()=>g.slice(0,v),[g,v]),oe=g.length!==W?`${g.length}/${W}`:`${W}`,R=l.useCallback(()=>n.displayWeapon.set({editWeaponId:""}),[n]),{editWeaponId:F}=c;F&&!n.weapons.get(F)&&R();const ne={numShowing:M.length,total:oe,t:u,namespace:"page_weapon"},ae={sortKeys:[..._e],value:y,onChange:t=>n.displayWeapon.set({sortType:t}),ascending:f,onChangeAsc:t=>n.displayWeapon.set({ascending:t})};return s(B,{display:"flex",flexDirection:"column",gap:1,children:[e(l.Suspense,{fallback:!1,children:e(De,{show:p,onHide:w,onSelect:d})}),e(l.Suspense,{fallback:!1,children:e(Ee,{weaponId:F,footer:!0,onClose:R})}),e(Ae,{numShowing:g.length,total:W,weaponIds:g}),e(X,{children:s(J,{sx:{display:"flex",flexDirection:"column",gap:1},children:[s(B,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:[e(Ke,{autoFocus:!0,size:"small",value:i,onChange:t=>S(t.target.value),label:u("weaponName"),sx:{height:"100%"},InputProps:{sx:{height:"100%"}}}),e(Be,{showingTextProps:ne,sortByButtonProps:ae})]}),e($e,{weaponIds:g})]})}),s(l.Suspense,{fallback:e(O,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:500}}),children:[e(x,{fullWidth:!0,onClick:o,color:"info",startIcon:e(Me,{}),children:u("page_weapon:addWeapon")}),e(h,{container:!0,spacing:1,columns:je,children:M.map(t=>e(h,{item:!0,xs:1,children:e(Fe,{weaponId:t,onDelete:D,onEdit:T,canEquip:!0})},t))})]}),g.length!==M.length&&e(O,{ref:t=>{t&&ee(t)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})}export{He as default};
