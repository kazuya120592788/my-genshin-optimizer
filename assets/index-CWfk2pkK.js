import{y as $,r,aZ as J,a as W,bJ as Q,d as e,bL as Z,ck as q,aq as G,b4 as R,cV as k,Q as X,S as I,cW as Y,b as ee,z as te,cX as ie,cY as se,ab as ae,bB as re,aD as ne,aE as oe,aA as le,aF as me,h as A,N as K,B as S,bj as _,aH as ce,ad as F,aI as ue,ag as ge,L as he,M as de,T as pe,G as B,cZ as be}from"./index-DS5KRQCa.js";import{T as fe}from"./TeamCard-Ee-Y-MTR.js";import{d as L}from"./Upload-CNzRhj2O.js";import"./useTeamChar-B7P_y4WL.js";import"./TeamDelModal-C7QSzG6Z.js";function Ne({teamIds:s,charKeys:a,setCharKey:c,acProps:l}){const{t:u}=$(["page_team","sillyWisher_charNames","charNames_gen"]),{silly:g}=r.useContext(J),o=W(),{gender:d}=Q(),h=r.useCallback(t=>o.charMeta.get(t).favorite,[o.charMeta]),j=r.useCallback(t=>e(Z,{characterKey:t},void 0,!1,{fileName:"D:/Projects/git/genshin-optimizer/libs/gi/ui/src/components/character/CharacterMultiAutocomplete.tsx",lineNumber:46,columnNumber:28},this),[]),N=r.useCallback((t,n)=>u(`${n?"sillyWisher_charNames":"charNames_gen"}:${q(t,d)}`),[d,u]),v=ee,[z,T]=G();r.useEffect(()=>o.chars.followAny((t,n)=>["new","remove"].includes(n)&&T()),[o.chars,T]);const p=r.useMemo(()=>z&&o.chars.keys,[o,z]),{characterTeamTotal:b}=r.useMemo(()=>R({characterTeamTotal:p},n=>{o.teams.values.forEach(x=>{const{loadoutData:D}=x;D.filter(k).forEach(({teamCharId:y})=>{const C=o.teamChars.get(y);if(!C)return;const f=C.key;n.characterTeamTotal[f].total++})}),s.forEach(x=>{const D=o.teams.get(x);if(!D)return;const{loadoutData:y}=D;y.filter(k).forEach(({teamCharId:C})=>{const f=o.teamChars.get(C);if(!f)return;const M=f.key;n.characterTeamTotal[M].current++})})}),[o,p,s]),P=r.useCallback(t=>e("strong",{children:b[t]},void 0,!1,{fileName:"D:/Projects/git/genshin-optimizer/libs/gi/ui/src/components/character/CharacterMultiAutocomplete.tsx",lineNumber:104,columnNumber:28},this),[b]),w=r.useCallback(t=>e(X,{size:"small",label:b[t]},void 0,!1,{fileName:"D:/Projects/git/genshin-optimizer/libs/gi/ui/src/components/character/CharacterMultiAutocomplete.tsx",lineNumber:109,columnNumber:7},this),[b]),E=r.useMemo(()=>p.map(t=>({key:t,label:N(t,g),alternateNames:g?[N(t,!g)]:void 0,favorite:h(t),color:v(t)})).sort((t,n)=>t.favorite&&!n.favorite?-1:!t.favorite&&n.favorite?1:t.label.localeCompare(n.label)),[g,N,v,h,p]);return e(r.Suspense,{fallback:e(I,{variant:"text",width:100},void 0,!1,{fileName:"D:/Projects/git/genshin-optimizer/libs/gi/ui/src/components/character/CharacterMultiAutocomplete.tsx",lineNumber:135,columnNumber:25},this),children:e(Y,{label:u("searchLabel.char"),options:E,toImg:j,valueKeys:a,onChange:t=>c(t),toExLabel:P,toExItemLabel:w,chipProps:{variant:"outlined"},...l},void 0,!1,{fileName:"D:/Projects/git/genshin-optimizer/libs/gi/ui/src/components/character/CharacterMultiAutocomplete.tsx",lineNumber:136,columnNumber:7},this)},void 0,!1,{fileName:"D:/Projects/git/genshin-optimizer/libs/gi/ui/src/components/character/CharacterMultiAutocomplete.tsx",lineNumber:135,columnNumber:5},this)}function xe(){return{name:s=>s.name??"",lastEdit:s=>s.lastEdit??0}}const ve={name:["name","lastEdit"],lastEdit:["lastEdit"]};function De(s){return{charKeys:(a,c)=>{var o;if(!c.length)return!0;const l=(o=s.teams.get(a))==null?void 0:o.loadoutData.filter(k),u=l==null?void 0:l.map(({teamCharId:d})=>{var h;return(h=s.teamChars.get(d))==null?void 0:h.key}).filter(k);return c.every(d=>u==null?void 0:u.includes(d))},name:(a,c)=>{var l;return!c||!!((l=s.teams.get(a))!=null&&l.name.toLowerCase().includes(c.toLowerCase()))}}}const ye={xs:1,sm:2,md:2,lg:3,xl:3},Ce={xs:6,sm:12,md:18,lg:24,xl:24};function Se(){const{t:s}=$(["page_team","page_teams","sillyWisher_charNames","charNames_gen"]),a=W(),[c,l]=G(),u=te(),g=ie();r.useEffect(()=>a.teams.followAny((i,m)=>(m==="new"||m==="remove"||m==="update")&&l()),[l,a]),se();const o=()=>{const i=a.teams.new();u(i)},[d,h,j]=ae(),[N,v]=r.useState("");r.useEffect(()=>{var i,m;(i=g.state)!=null&&i.openImportModal&&(v((m=g.state)==null?void 0:m.teamData),h())},[g.state,h,v]);const z=()=>{try{const i=JSON.parse(N);a.teams.import(i)||window.alert(s("importForm.error.verifi")),j()}catch(i){window.alert(s("importForm.error.import")+`
${i}`);return}},T=re(a.displayTeam),{sortType:p,ascending:b,charKeys:P}=T,[w,E]=r.useState(T.searchTerm),t=r.useDeferredValue(w);r.useEffect(()=>{a.displayTeam.set({searchTerm:t})},[a,t]);const{teamIds:n,totalTeamNum:x}=r.useMemo(()=>{const i=a.teams.keys.length,m=a.teams.keys.filter(ne({charKeys:P,name:t},De(a))).sort((O,U)=>oe(ve[p],b,xe())(a.teams.get(O),a.teams.get(U)));return c&&{teamIds:m,totalTeamNum:i}},[c,a,P,t,p,b]),D=le(),{numShow:y,setTriggerElement:C}=me(Ce[D],n.length),f=r.useMemo(()=>n.slice(0,y),[n,y]),M=n.length!==x?`${n.length}/${x}`:`${x}`,H={numShowing:f.length,total:M,t:s,namespace:"page_teams"},V={sortKeys:[...be],value:p,onChange:i=>a.displayTeam.set({sortType:i}),ascending:b,onChangeAsc:i=>a.displayTeam.set({ascending:i})};return e(S,{display:"flex",flexDirection:"column",gap:1,children:[e(A,{children:e(K,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e(S,{display:"flex",gap:1,alignItems:"stretch",children:[e(Ne,{teamIds:n,charKeys:P,setCharKey:i=>a.displayTeam.set({charKeys:i}),acProps:{sx:{flexGrow:1}}},void 0,!1,{fileName:"D:\\Projects\\git\\genshin-optimizer\\libs\\gi\\page-teams\\src\\index.tsx",lineNumber:153,columnNumber:13},this),e(_,{autoFocus:!0,value:w,onChange:i=>E(i.target.value),label:s("searchLabel.team"),sx:{height:"100%",flexGrow:1},InputProps:{sx:{height:"100%"}}},void 0,!1,{fileName:"D:\\Projects\\git\\genshin-optimizer\\libs\\gi\\page-teams\\src\\index.tsx",lineNumber:159,columnNumber:13},this)]},void 0,!0,{fileName:"D:\\Projects\\git\\genshin-optimizer\\libs\\gi\\page-teams\\src\\index.tsx",lineNumber:152,columnNumber:11},this),e(S,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:e(ce,{showingTextProps:H,sortByButtonProps:V},void 0,!1,{fileName:"D:\\Projects\\git\\genshin-optimizer\\libs\\gi\\page-teams\\src\\index.tsx",lineNumber:179,columnNumber:13},this)},void 0,!1,{fileName:"D:\\Projects\\git\\genshin-optimizer\\libs\\gi\\page-teams\\src\\index.tsx",lineNumber:173,columnNumber:11},this)]},void 0,!0,{fileName:"D:\\Projects\\git\\genshin-optimizer\\libs\\gi\\page-teams\\src\\index.tsx",lineNumber:151,columnNumber:9},this)},void 0,!1,{fileName:"D:\\Projects\\git\\genshin-optimizer\\libs\\gi\\page-teams\\src\\index.tsx",lineNumber:150,columnNumber:7},this),e(S,{sx:{display:"flex",gap:1},children:[e(F,{fullWidth:!0,onClick:o,color:"info",startIcon:e(ue,{},void 0,!1,{fileName:"D:\\Projects\\git\\genshin-optimizer\\libs\\gi\\page-teams\\src\\index.tsx",lineNumber:188,columnNumber:67},this),children:s("addTeamBtn")},void 0,!1,{fileName:"D:\\Projects\\git\\genshin-optimizer\\libs\\gi\\page-teams\\src\\index.tsx",lineNumber:188,columnNumber:9},this),e(ge,{open:d,onClose:j,children:e(A,{children:[e(he,{title:s("importForm.title")},void 0,!1,{fileName:"D:\\Projects\\git\\genshin-optimizer\\libs\\gi\\page-teams\\src\\index.tsx",lineNumber:193,columnNumber:13},this),e(de,{},void 0,!1,{fileName:"D:\\Projects\\git\\genshin-optimizer\\libs\\gi\\page-teams\\src\\index.tsx",lineNumber:194,columnNumber:13},this),e(K,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e(pe,{children:s("importForm.desc")},void 0,!1,{fileName:"D:\\Projects\\git\\genshin-optimizer\\libs\\gi\\page-teams\\src\\index.tsx",lineNumber:198,columnNumber:15},this),e(_,{fullWidth:!0,label:s("importForm.label"),placeholder:s("importForm.placeholder"),value:N,onChange:i=>v(i.target.value),multiline:!0,rows:4},void 0,!1,{fileName:"D:\\Projects\\git\\genshin-optimizer\\libs\\gi\\page-teams\\src\\index.tsx",lineNumber:199,columnNumber:15},this),e(F,{startIcon:e(L,{},void 0,!1,{fileName:"D:\\Projects\\git\\genshin-optimizer\\libs\\gi\\page-teams\\src\\index.tsx",lineNumber:209,columnNumber:28},this),disabled:!N,onClick:z,children:s("importForm.importBtn")},void 0,!1,{fileName:"D:\\Projects\\git\\genshin-optimizer\\libs\\gi\\page-teams\\src\\index.tsx",lineNumber:208,columnNumber:15},this)]},void 0,!0,{fileName:"D:\\Projects\\git\\genshin-optimizer\\libs\\gi\\page-teams\\src\\index.tsx",lineNumber:195,columnNumber:13},this)]},void 0,!0,{fileName:"D:\\Projects\\git\\genshin-optimizer\\libs\\gi\\page-teams\\src\\index.tsx",lineNumber:192,columnNumber:11},this)},void 0,!1,{fileName:"D:\\Projects\\git\\genshin-optimizer\\libs\\gi\\page-teams\\src\\index.tsx",lineNumber:191,columnNumber:9},this),e(F,{fullWidth:!0,onClick:h,color:"info",startIcon:e(L,{},void 0,!1,{fileName:"D:\\Projects\\git\\genshin-optimizer\\libs\\gi\\page-teams\\src\\index.tsx",lineNumber:222,columnNumber:22},this),children:s("importTeamBtn")},void 0,!1,{fileName:"D:\\Projects\\git\\genshin-optimizer\\libs\\gi\\page-teams\\src\\index.tsx",lineNumber:218,columnNumber:9},this)]},void 0,!0,{fileName:"D:\\Projects\\git\\genshin-optimizer\\libs\\gi\\page-teams\\src\\index.tsx",lineNumber:187,columnNumber:7},this),e(r.Suspense,{fallback:e(I,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:5e3}},void 0,!1,{fileName:"D:\\Projects\\git\\genshin-optimizer\\libs\\gi\\page-teams\\src\\index.tsx",lineNumber:229,columnNumber:11},this),children:e(B,{container:!0,spacing:2,columns:ye,children:f.map(i=>e(B,{item:!0,xs:1,children:e(r.Suspense,{fallback:e(I,{variant:"rectangular",width:"100%",height:150},void 0,!1,{fileName:"D:\\Projects\\git\\genshin-optimizer\\libs\\gi\\page-teams\\src\\index.tsx",lineNumber:240,columnNumber:19},this),children:e(fe,{teamId:i,bgt:"light",onClick:m=>u(`${i}${m?`/${m}`:""}`)},void 0,!1,{fileName:"D:\\Projects\\git\\genshin-optimizer\\libs\\gi\\page-teams\\src\\index.tsx",lineNumber:243,columnNumber:17},this)},void 0,!1,{fileName:"D:\\Projects\\git\\genshin-optimizer\\libs\\gi\\page-teams\\src\\index.tsx",lineNumber:238,columnNumber:15},this)},i,!1,{fileName:"D:\\Projects\\git\\genshin-optimizer\\libs\\gi\\page-teams\\src\\index.tsx",lineNumber:237,columnNumber:13},this))},void 0,!1,{fileName:"D:\\Projects\\git\\genshin-optimizer\\libs\\gi\\page-teams\\src\\index.tsx",lineNumber:235,columnNumber:9},this)},void 0,!1,{fileName:"D:\\Projects\\git\\genshin-optimizer\\libs\\gi\\page-teams\\src\\index.tsx",lineNumber:227,columnNumber:7},this),n.length!==f.length&&e(I,{ref:i=>{i&&C(i)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100},void 0,!1,{fileName:"D:\\Projects\\git\\genshin-optimizer\\libs\\gi\\page-teams\\src\\index.tsx",lineNumber:254,columnNumber:9},this)]},void 0,!0,{fileName:"D:\\Projects\\git\\genshin-optimizer\\libs\\gi\\page-teams\\src\\index.tsx",lineNumber:149,columnNumber:5},this)}export{Se as default};
